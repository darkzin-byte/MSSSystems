<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora de Rescisão Trabalhista - MSS Systems</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background-color: #f5f7fa;
  color: #1a202c;
  padding: 20px;
}

h1 {
  color: #005ba1;
  margin-bottom: 30px;
  font-size: 28px;
  font-weight: 600;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
}

label {
  display: block;
  margin-top: 12px;
  font-weight: 500;
  color: #2d3748;
  font-size: 14px;
}

input, select {
  padding: 8px 12px;
  margin-top: 5px;
  width: 100%;
  border: 1px solid #cbd5e0;
  border-radius: 6px;
  font-size: 14px;
  transition: border-color 0.2s;
}

input:focus, select:focus {
  outline: none;
  border-color: #005ba1;
  box-shadow: 0 0 0 3px rgba(0, 91, 161, 0.1);
}

.main-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 20px;
}

@media (max-width: 1024px) {
  .main-grid {
    grid-template-columns: 1fr;
  }
}

.card {
  background: white;
  padding: 24px;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
}

.card h2 {
  color: #005ba1;
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 2px solid #e2e8f0;
}

.form-group {
  margin-bottom: 16px;
}

.form-group label {
  display: block;
  margin-bottom: 6px;
  font-weight: 500;
  color: #2d3748;
  font-size: 14px;
}

.form-group input,
.form-group select {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #cbd5e0;
  border-radius: 6px;
  font-size: 14px;
  transition: all 0.2s;
  font-family: inherit;
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: #005ba1;
  box-shadow: 0 0 0 3px rgba(0, 91, 161, 0.1);
}

.input-with-prefix {
  position: relative;
}

.input-with-prefix input {
  padding-left: 48px;
}

.input-prefix {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: #005ba1;
  font-weight: 600;
  font-size: 14px;
}

.checkbox-group {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 10px;
  padding: 10px;
  background: #f8fafc;
  border-radius: 6px;
}

.checkbox-group input {
  width: 18px;
  height: 18px;
  margin: 0;
  cursor: pointer;
}

.checkbox-group label {
  margin: 0;
  font-weight: 500;
  cursor: pointer;
  color: #2d3748;
  font-size: 14px;
}

.btn {
  padding: 10px 16px;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  width: 100%;
  margin-top: 16px;
}

.btn-primary {
  background-color: #005ba1;
  color: white;
}

.btn-primary:hover:not(:disabled) {
  background-color: #00457d;
  box-shadow: 0 2px 4px rgba(0, 91, 161, 0.2);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.resultado {
  margin-top: 20px;
  padding: 20px;
  background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
  border: 2px solid #cbd5e0;
  border-radius: 8px;
}

.resultado h3 {
  color: #2d3748;
  margin-bottom: 16px;
  font-size: 15px;
  font-weight: 600;
}

.resultado-item {
  display: flex;
  justify-content: space-between;
  padding: 10px 0;
  border-bottom: 1px solid #e2e8f0;
  align-items: center;
}

.resultado-item:last-child {
  border-bottom: none;
}

.resultado-item strong {
  color: #2d3748;
  font-size: 14px;
}

.resultado-item span {
  color: #005ba1;
  font-weight: 600;
  font-size: 14px;
}

.total-destaque {
  background-color: #005ba1;
  color: white;
  margin: 16px -20px -20px;
  padding: 16px 20px;
  border-radius: 0 0 8px 8px;
  font-size: 16px;
  font-weight: 600;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
}

thead tr {
  background-color: #005ba1;
}

th {
  color: white;
  padding: 12px;
  text-align: left;
  font-weight: 600;
  font-size: 13px;
}

td {
  padding: 12px;
  border-bottom: 1px solid #e2e8f0;
  font-size: 14px;
}

tbody tr {
  background-color: #fafbfc;
}

tbody tr:hover {
  background-color: #f0f4f8;
}

.btn-remove {
  background-color: #fed7d7;
  color: #c53030;
  border: none;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 500;
  transition: all 0.2s;
}

.btn-remove:hover {
  background-color: #fc8787;
  color: white;
}

.empty-state {
  text-align: center;
  padding: 40px 20px;
  color: #718096;
}

.empty-state svg {
  margin-bottom: 16px;
  opacity: 0.5;
}

.empty-state p {
  font-size: 14px;
}

.info-box {
  background: #fff9e6;
  border-left: 4px solid #d97706;
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 20px;
}

.info-box p {
  color: #92400e;
  font-size: 14px;
  line-height: 1.5;
}
</style>
</head>
<body>
  <div class="container">
    <h1>Calculadora de Rescisão Trabalhista - MSS Systems</h1>

    <div class="main-grid">
      <div class="card">
        <h2>Dados do Funcionário</h2>
        <div class="info-box">
          <p><strong>Atenção:</strong> Este cálculo é estimativo. Consulte um contador ou advogado trabalhista para valores precisos.</p>
        </div>
        
        <!-- Primeira etapa: apenas 4 campos básicos -->
        <div id="etapa1">
          <div class="form-group">
            <label for="nome">Nome do Funcionário</label>
            <input type="text" id="nome" placeholder="Digite o nome completo">
          </div>
          
          <div class="form-group">
            <label for="salario">Salário Bruto Mensal</label>
            <div class="input-with-prefix">
              <span class="input-prefix">R$</span>
              <input type="number" id="salario" placeholder="1600.00" step="0.01" min="0">
            </div>
          </div>
          
          <div class="form-group">
            <label for="dataAdmissao">Data de Admissão</label>
            <input type="date" id="dataAdmissao">
          </div>
          
          <div class="form-group">
            <label for="dataRescisao">Data de Rescisão</label>
            <input type="date" id="dataRescisao">
          </div>
          
          <button class="btn btn-primary" onclick="continuarParaEtapa2()">Continuar</button>
        </div>

        <!-- Segunda etapa: perguntas dinâmicas e tipo de rescisão -->
        <div id="etapa2" style="display: none;">
          <div class="form-group">
            <label for="tipoRescisao">Tipo de Rescisão</label>
            <select id="tipoRescisao">
              <option value="semJustaCausa">Demissão sem Justa Causa</option>
              <option value="pedidoDemissao">Pedido de Demissão</option>
              <option value="justaCausa">Demissão por Justa Causa</option>
              <option value="acordoMutuo">Acordo Mútuo</option>
            </select>
          </div>

          <div id="perguntasDinamicas" style="margin-top: 20px;"></div>
          
          <div style="display: flex; gap: 12px; margin-top: 20px;">
            <button class="btn" style="background: #6b7280; flex: 1;" onclick="voltarParaEtapa1()">Voltar</button>
            <button class="btn btn-primary" style="flex: 2;" onclick="calcularRescisao()">Calcular Rescisão</button>
          </div>
        </div>

        <div id="resultado"></div>
      </div>

      <div class="card">
        <h2>Histórico de Cálculos</h2>
        <table id="tabelaHistorico">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Salário</th>
              <th>Tipo</th>
              <th>Tempo</th>
              <th>Total Líquido</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="historicoBody">
          </tbody>
        </table>
        <button class="btn btn-primary" id="baixarPdf" style="width: 100%; margin-top: 20px;">Baixar Demonstrativo em PDF</button>
      </div>
    </div>
  </div>

  <script>
    let historico = [];
    let ultimoResultado = null;
    window.ultimoResultado = null;

    function moeda(v) {
      return (v || 0).toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    }

    function continuarParaEtapa2() {
      const nome = document.getElementById('nome').value.trim();
      const salario = parseFloat(document.getElementById('salario').value) || 0;
      const dataAdmissao = document.getElementById('dataAdmissao').value;
      const dataRescisao = document.getElementById('dataRescisao').value;
      
      if (!nome || !salario || !dataAdmissao || !dataRescisao) {
        alert('Por favor, preencha todos os campos obrigatórios!');
        return;
      }
      
      const d1 = new Date(dataAdmissao + 'T00:00:00');
      const d2 = new Date(dataRescisao + 'T00:00:00');
      
      if (d2 < d1) {
        alert('Data de rescisão não pode ser anterior à data de admissão!');
        return;
      }
      
      gerarPerguntasDinamicas(d1, d2);
      
      document.getElementById('etapa1').style.display = 'none';
      document.getElementById('etapa2').style.display = 'block';
    }
    
    function voltarParaEtapa1() {
      document.getElementById('etapa2').style.display = 'none';
      document.getElementById('etapa1').style.display = 'block';
    }
    
    function gerarPerguntasDinamicas(d1, d2) {
      const container = document.getElementById('perguntasDinamicas');
      
      // Calcular anos completos (até 11 meses e 29 dias conta como ano anterior)
      let meses = (d2.getFullYear() - d1.getFullYear()) * 12 + (d2.getMonth() - d1.getMonth());
      let dias = d2.getDate() - d1.getDate();
      if (dias < 0) {
        meses--;
      }
      
      const anosCompletos = Math.floor(meses / 12);
      const maxFerias = anosCompletos; // 1 ano = 1 férias, 2 anos = 2 férias, etc.
      
      let html = '';
      
      if (anosCompletos >= 1) {
        html += `
          <div class="form-group">
            <label>Possui férias vencidas (não gozadas)?</label>
            <select id="feriasVencidas" style="margin-top: 8px;">
              <option value="0">Não</option>
        `;
        
        for (let i = 1; i <= maxFerias; i++) {
          html += `<option value="${i}">${i} período${i > 1 ? 's' : ''}</option>`;
        }
        
        html += `
            </select>
          </div>
        `;
      }
      
      const anoAdmissao = d1.getFullYear();
      const anoRescisao = d2.getFullYear();
      
      html += `
        <div class="form-group">
          <label style="margin-bottom: 12px;">Marque os anos em que NÃO recebeu o 13º salário:</label>
          <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px;">
      `;
      
      for (let ano = anoAdmissao; ano <= anoRescisao; ano++) {
        html += `
          <div class="checkbox-group" style="flex: 0 0 auto; min-width: 100px;">
            <input type="checkbox" id="ano13_${ano}" value="${ano}">
            <label for="ano13_${ano}">${ano}</label>
          </div>
        `;
      }
      
      html += `
          </div>
        </div>
      `;
      
      container.innerHTML = html;
    }

    function calcularRescisao() {
      const nome = document.getElementById('nome').value.trim();
      const salario = parseFloat(document.getElementById('salario').value) || 0;
      const dataAdmissao = document.getElementById('dataAdmissao').value;
      const dataRescisao = document.getElementById('dataRescisao').value;
      const tipoRescisao = document.getElementById('tipoRescisao').value;

      if (!nome || !salario || !dataAdmissao || !dataRescisao) {
        alert('Preencha todos os campos obrigatórios!');
        return;
      }

      const d1 = new Date(dataAdmissao + 'T00:00:00');
      const d2 = new Date(dataRescisao + 'T00:00:00');
      
      if (d2 < d1) {
        alert('Data de rescisão não pode ser anterior à admissão!');
        return;
      }

      let meses = (d2.getFullYear() - d1.getFullYear()) * 12 + (d2.getMonth() - d1.getMonth());
      let dias = d2.getDate() - d1.getDate();
      
      if (dias < 0) {
        meses--;
        const ultimoDiaMesAnterior = new Date(d2.getFullYear(), d2.getMonth(), 0).getDate();
        dias += ultimoDiaMesAnterior;
      }

      const anoAdmissao = d1.getFullYear();
      const anoRescisao = d2.getFullYear();
      let mesesPara13 = 0;
      
      for (let ano = anoAdmissao; ano <= anoRescisao; ano++) {
        const checkbox = document.getElementById(`ano13_${ano}`);
        if (checkbox && checkbox.checked) {
          let mesInicio = (ano === anoAdmissao) ? d1.getMonth() : 0;
          let mesFim = (ano === anoRescisao) ? d2.getMonth() : 11;
          mesesPara13 += (mesFim - mesInicio + 1);
        }
      }
      
      const decimo = (salario / 12 * mesesPara13) + (salario / 12 / 30 * dias);

      const feriasBase = (salario / 12 * meses) + (salario / 12 / 30 * dias);
      const feriasTotal = feriasBase * 1.3333;

      const feriasVencidasSelect = document.getElementById('feriasVencidas');
      const feriasVencidas = feriasVencidasSelect ? parseInt(feriasVencidasSelect.value) || 0 : 0;
      const feriasVenc = feriasVencidas * salario * 1.3333;

      let aviso = 0;
      if (tipoRescisao === 'semJustaCausa') {
        aviso = salario;
      } else if (tipoRescisao === 'acordoMutuo') {
        aviso = salario * 0.5;
      }

      let fgts = 0;
      let jurosFgts = 0;
      let fgtsCorrigido = 0;
      let multa40 = 0;

      if (tipoRescisao === 'semJustaCausa' || tipoRescisao === 'acordoMutuo') {
        fgts = ((salario * 0.08) * meses) + ((salario * 0.08 / 30) * dias);
        jurosFgts = fgts * 0.0025 * meses;
        fgtsCorrigido = fgts + jurosFgts;
        
        if (tipoRescisao === 'semJustaCausa') {
          multa40 = fgtsCorrigido * 0.40;
        } else if (tipoRescisao === 'acordoMutuo') {
          multa40 = fgtsCorrigido * 0.20;
        }
      }

      const totalVerbas = decimo + feriasTotal + feriasVenc + aviso + multa40;
      const saldoLiquido = totalVerbas;

      const resultado = {
        nome, salario, meses, dias, tipoRescisao, decimo, feriasTotal, feriasVenc,
        aviso, fgts, jurosFgts, fgtsCorrigido, multa40, totalVerbas, saldoLiquido,
        mesesPara13
      };

      ultimoResultado = resultado;
      window.ultimoResultado = resultado;

      const tipoLabel = {
        semJustaCausa: 'Sem Justa Causa',
        pedidoDemissao: 'Pedido de Demissão',
        justaCausa: 'Justa Causa',
        acordoMutuo: 'Acordo Mútuo'
      }[tipoRescisao];

      document.getElementById('resultado').innerHTML = `
        <div class="resultado">
          <h3>Resultado do Cálculo</h3>
          <div class="resultado-item"><strong>Nome:</strong><span>${nome}</span></div>
          <div class="resultado-item"><strong>Salário:</strong><span>R$ ${moeda(salario)}</span></div>
          <div class="resultado-item"><strong>Tempo de Serviço:</strong><span>${meses} meses e ${dias} dias</span></div>
          <div class="resultado-item"><strong>Tipo:</strong><span>${tipoLabel}</span></div>
          <hr style="margin:16px 0;border:none;border-top:2px solid #e2e8f0">
          ${decimo > 0 ? `<div class="resultado-item"><strong>13º Salário:</strong><span>R$ ${moeda(decimo)}</span></div>` : ''}
          <div class="resultado-item"><strong>Férias + 1/3:</strong><span>R$ ${moeda(feriasTotal)}</span></div>
          ${feriasVenc > 0 ? `<div class="resultado-item"><strong>Férias Vencidas + 1/3:</strong><span>R$ ${moeda(feriasVenc)}</span></div>` : ''}
          ${aviso > 0 ? `<div class="resultado-item"><strong>Aviso Prévio:</strong><span>R$ ${moeda(aviso)}</span></div>` : ''}
          ${fgts > 0 ? `<div class="resultado-item"><strong>FGTS (8%):</strong><span>R$ ${moeda(fgts)}</span></div>` : ''}
          ${jurosFgts > 0 ? `<div class="resultado-item"><strong>Juros FGTS (0,25%/mês):</strong><span>R$ ${moeda(jurosFgts)}</span></div>` : ''}
          ${fgtsCorrigido > 0 ? `<div class="resultado-item"><strong>FGTS Corrigido:</strong><span>R$ ${moeda(fgtsCorrigido)}</span></div>` : ''}
          ${multa40 > 0 ? `<div class="resultado-item"><strong>Multa FGTS (${tipoRescisao === 'acordoMutuo' ? '20' : '40'}%):</strong><span>R$ ${moeda(multa40)}</span></div>` : ''}
          <div class="total-destaque">
            <span>SALDO LÍQUIDO A RECEBER</span>
            <span>R$ ${moeda(saldoLiquido)}</span>
          </div>
        </div>
      `;

      historico.push(resultado);
      atualizarTabela();
    }

    function atualizarTabela() {
      const tbody = document.getElementById('historicoBody');
      
      if (historico.length === 0) {
        atualizarTabelaVazia();
        return;
      }
      
      const tipoLabel = {
        semJustaCausa: 'S/ Justa Causa',
        pedidoDemissao: 'Pedido Demissão',
        justaCausa: 'Justa Causa',
        acordoMutuo: 'Acordo Mútuo'
      };
      
      tbody.innerHTML = historico.map((r, i) => `
        <tr>
          <td>${r.nome}</td>
          <td>R$ ${moeda(r.salario)}</td>
          <td>${tipoLabel[r.tipoRescisao] || r.tipoRescisao}</td>
          <td>${r.meses}m ${r.dias}d</td>
          <td><strong style="color:#005ba1">R$ ${moeda(r.saldoLiquido)}</strong></td>
          <td><button class="btn-remove" onclick="removerItem(${i})">Remover</button></td>
        </tr>
      `).join('');
    }

    function atualizarTabelaVazia() {
      document.getElementById('historicoBody').innerHTML = `
        <tr>
          <td colspan="6" class="empty-state">
            <svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            <p>Nenhum cálculo realizado ainda</p>
          </td>
        </tr>
      `;
    }

    function removerItem(idx) {
      historico.splice(idx, 1);
      atualizarTabela();
    }

    document.getElementById('baixarPdf').addEventListener('click', async () => {
      const r = window.ultimoResultado;
      if (!r) {
        alert('Faça um cálculo antes de baixar o PDF.');
        return;
      }

      const node = document.createElement('div');
      node.style.width = '800px';
      node.style.padding = '40px';
      node.style.fontFamily = 'Arial, sans-serif';
      node.style.background = 'white';
      
      const tipoLabel = {
        semJustaCausa: 'Sem Justa Causa',
        pedidoDemissao: 'Pedido de Demissão',
        justaCausa: 'Justa Causa',
        acordoMutuo: 'Acordo Mútuo'
      }[r.tipoRescisao];
      
      node.innerHTML = `
        <div style="background: linear-gradient(135deg, #005ba1 0%, #00457d 100%); color: white; padding: 30px; margin: -40px -40px 30px -40px; text-align: center;">
          <h1 style="margin: 0; font-size: 28px; font-weight: bold;">MSS Systems</h1>
          <p style="margin: 8px 0 0 0; font-size: 14px; opacity: 0.9;">Demonstrativo de Rescisão Trabalhista</p>
        </div>

        <div style="border: 2px solid #005ba1; border-radius: 8px; overflow: hidden; margin-bottom: 20px;">
          <div style="background-color: #005ba1; color: white; padding: 20px; text-align: center;">
            <h2 style="margin: 0; font-size: 18px;">Funcionário: ${r.nome}</h2>
            <p style="margin: 5px 0 0 0; font-size: 12px; opacity: 0.9;">Tipo: ${tipoLabel}</p>
          </div>

          <div style="padding: 25px;">
            <div style="margin-bottom: 20px;">
              <h3 style="color: #005ba1; margin: 0 0 12px 0; font-size: 14px;">Informações Básicas</h3>
              <div style="background: #f5f7fa; padding: 15px; border-radius: 6px;">
                <p style="margin: 8px 0;"><strong>Salário Base:</strong> R$ ${moeda(r.salario)}</p>
                <p style="margin: 8px 0;"><strong>Tempo de Serviço:</strong> ${r.meses} meses e ${r.dias} dias</p>
              </div>
            </div>

            <div>
              <h3 style="color: #005ba1; margin: 0 0 12px 0; font-size: 14px;">Verbas Rescisórias</h3>
              <table style="width: 100%; border-collapse: collapse;">
                <thead>
                  <tr style="background-color: #f5f7fa;">
                    <th style="text-align: left; padding: 10px; border-bottom: 2px solid #e2e8f0; color: #2d3748; font-size: 13px;">Descrição</th>
                    <th style="text-align: right; padding: 10px; border-bottom: 2px solid #e2e8f0; color: #2d3748; font-size: 13px;">Valor (R$)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">13º Salário</td>
                    <td style="text-align: right; padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">${moeda(r.decimo)}</td>
                  </tr>
                  <tr>
                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">Férias + 1/3</td>
                    <td style="text-align: right; padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">${moeda(r.feriasTotal)}</td>
                  </tr>
                  ${r.feriasVenc > 0 ? `
                  <tr>
                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">Férias Vencidas + 1/3</td>
                    <td style="text-align: right; padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">${moeda(r.feriasVenc)}</td>
                  </tr>
                  ` : ''}
                  ${r.aviso > 0 ? `
                  <tr>
                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">Aviso Prévio</td>
                    <td style="text-align: right; padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">${moeda(r.aviso)}</td>
                  </tr>
                  ` : ''}
                  ${r.fgts > 0 ? `
                  <tr>
                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">FGTS (8%)</td>
                    <td style="text-align: right; padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">${moeda(r.fgts)}</td>
                  </tr>
                  ` : ''}
                  ${r.jurosFgts > 0 ? `
                  <tr>
                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">Juros FGTS (0,25%/mês)</td>
                    <td style="text-align: right; padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">${moeda(r.jurosFgts)}</td>
                  </tr>
                  ` : ''}
                  ${r.fgtsCorrigido > 0 ? `
                  <tr>
                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">FGTS Corrigido</td>
                    <td style="text-align: right; padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">${moeda(r.fgtsCorrigido)}</td>
                  </tr>
                  ` : ''}
                  ${r.multa40 > 0 ? `
                  <tr>
                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">Multa FGTS (${r.tipoRescisao === 'acordoMutuo' ? '20' : '40'}%)</td>
                    <td style="text-align: right; padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 13px;">${moeda(r.multa40)}</td>
                  </tr>
                  ` : ''}
                  <tr style="background-color: #f5f7fa;">
                    <td style="padding: 12px; font-weight: bold; font-size: 14px; color: #2d3748;">Total de Verbas</td>
                    <td style="text-align: right; padding: 12px; font-weight: bold; font-size: 14px; color: #2d3748;">${moeda(r.totalVerbas)}</td>
                  </tr>
                  <tr style="background-color: #005ba1;">
                    <td style="padding: 15px; font-weight: bold; font-size: 15px; color: white;">SALDO LÍQUIDO A RECEBER</td>
                    <td style="text-align: right; padding: 15px; font-weight: bold; font-size: 15px; color: white;">${moeda(r.saldoLiquido)}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div style="background: #fff9e6; border-left: 4px solid #d97706; padding: 15px; border-radius: 6px; margin-top: 20px;">
          <p style="margin: 0; font-size: 12px; color: #92400e; line-height: 1.6;">
            <strong>Observação:</strong> Este demonstrativo é estimativo e não substitui o cálculo oficial do RH/Contabilidade. 
            Os valores podem variar conforme convenção coletiva e acordos individuais. Consulte um contador ou advogado trabalhista 
            para confirmação dos valores.
          </p>
        </div>

        <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e2e8f0; text-align: center; color: #718096; font-size: 12px;">
          <p style="margin: 0;"><strong>MSS Systems</strong></p>
          <p style="margin: 5px 0 0 0;">Documento gerado em ${new Date().toLocaleDateString('pt-BR')} às ${new Date().toLocaleTimeString('pt-BR')}</p>
        </div>
      `;

      document.body.appendChild(node);

      const canvas = await html2canvas(node, { scale: 2, backgroundColor: '#ffffff' });
      const imgData = canvas.toDataURL('image/png');
      
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation: 'portrait', unit: 'pt', format: 'a4' });
      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();
      const imgProps = pdf.getImageProperties(imgData);
      const imgWidth = pageWidth;
      const imgHeight = (imgProps.height * imgWidth) / imgProps.width;
      
      pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
      pdf.save(`rescisao_${r.nome.replace(/\s+/g, '_')}_${new Date().toLocaleDateString('pt-BR').replace(/\//g, '-')}.pdf`);
      
      document.body.removeChild(node);
    });

    atualizarTabelaVazia();

    const hoje = new Date();
    document.getElementById('dataRescisao').valueAsDate = hoje;
    const umAnoAtras = new Date(hoje);
    umAnoAtras.setFullYear(hoje.getFullYear() - 1);
    document.getElementById('dataAdmissao').valueAsDate = umAnoAtras;
    
    // Continuar para etapa 2 ao carregar a página se já houver dados preenchidos
    const nomeInput = document.getElementById('nome');
    const salarioInput = document.getElementById('salario');
    const dataAdmissaoInput = document.getElementById('dataAdmissao');
    const dataRescisaoInput = document.getElementById('dataRescisao');
    
    if (nomeInput.value && salarioInput.value && dataAdmissaoInput.value && dataRescisaoInput.value) {
      continuarParaEtapa2();
    }
  </script>
</body>
</html>
